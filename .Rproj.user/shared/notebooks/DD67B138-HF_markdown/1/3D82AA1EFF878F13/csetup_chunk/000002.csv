"0","knitr::opts_chunk$set(echo = TRUE)"
"0",""
"0","### Health Foundation: COVID and hip replacement and diabetes activity "
"0",""
"0","library(tidyverse)"
"0","library(odbc)"
"0","library(DBI)"
"0","library(plotly)"
"0",""
"0","## Set SU theme ####"
"0","My_rgb2hex <- function(r,g,b) sprintf('#%s',paste(as.hexmode(c(r,g,b)),collapse = ''))"
"0",""
"0","SU_colours <- c ("
"0","  `orange` = My_rgb2hex(248,191,7),# ""#f9bf07"","
"0","  `charcoal` = My_rgb2hex(44,40,37),# ""#2c2825"","
"0","  `slate` = My_rgb2hex(104,111,115), # ""#686f73"","
"0","  `blue` = My_rgb2hex(88,29,193), # ""#5881c1"","
"0","  `red` = My_rgb2hex(236,101,85), # ""#ec6555"","
"0","  #additional accent colours from word doc template"
"0","  `yellow` = My_rgb2hex(252,229,155),"
"0","  `grey` = My_rgb2hex(163,168,172),"
"0","  `white` = My_rgb2hex(255,255,255),"
"0","  #light and dark ends from colour theme in word doc"
"0","  `light orange` = My_rgb2hex(253,242,205),"
"0","  `dark orange` = My_rgb2hex(124,95,3),"
"0","  `light charcoal` = My_rgb2hex(235,233,231),"
"0","  `dark charcoal` = 	""#000000"",#black"
"0","  `light slate` = My_rgb2hex(224,226,227),"
"0","  `dark slate` = My_rgb2hex(51,55,57),"
"0","  `light blue` = My_rgb2hex(221,229,242),"
"0","  `dark blue` = My_rgb2hex(38,61,102),"
"0","  `light red` = My_rgb2hex(251,224,220),"
"0","  `dark red` = My_rgb2hex(144,29,16),"
"0","  `light yellow` = My_rgb2hex(254,249,235),"
"0","  `dark yellow` = My_rgb2hex(197,152,5),"
"0","  `light grey`=My_rgb2hex(236,237,238),"
"0","  `dark grey` = My_rgb2hex(79,84,88),"
"0","  `light white`=My_rgb2hex(242,242,242),"
"0","  `dark white` =My_rgb2hex(127,127,127),"
"0","  `red2` = My_rgb2hex(215,25,28),"
"0","  `orange2` = My_rgb2hex(253,174,97),"
"0","  `yellow2` = My_rgb2hex(255,255,191),"
"0","  `green2` = My_rgb2hex(171,221,164),"
"0","  `blue2` = My_rgb2hex(43,131,186)"
"0",")"
"0",""
"0",""
"0",""
"0","SU_cols <- function(...) {"
"0","  cols <- c(...)"
"0","  "
"0","  if (is.null(cols))"
"0","    return (SU_colours)"
"0","  "
"0","  SU_colours[cols]"
"0","}"
"0",""
"0","SU_palettes <- list("
"0","  `main` = SU_cols(""orange"",""charcoal"",""slate"",""blue"",""red""),"
"0","  `oranges` = SU_cols(""light orange"",""orange"",""dark orange""),"
"0","  `slates` = SU_cols(""light slate"",""slate"",""dark slate""),"
"0","  `mixed` = SU_cols(""dark red"",""orange"",""yellow"",""light blue"",""slate""),"
"0","  `oj_coal` = SU_cols(""yellow"",""orange"",""red"",""dark red"",""dark charcoal""),"
"0","  `oj_red` = SU_cols(""yellow"",""orange"",""red"",""dark red""),"
"0","  `white_oj_coal` = SU_cols(""white"",""yellow"",""orange"",""red"",""dark red"",""dark charcoal""),#added since shared"
"0","  `lyellow_oj_coal` = SU_cols(""light yellow"",""orange"",""red"",""dark red"",""dark charcoal""),#added since shared"
"0","  `wy_oj_coal` = SU_cols(""white"",""light yellow"",""yellow"",""orange"",""red"",""dark red"",""charcoal"",""dark charcoal""),"
"0","  `red_coal` = SU_cols(""red"",""dark red"",""charcoal"",""dark charcoal""),"
"0","  `blue_yellow_red` = SU_cols(""red2"",""orange2"",""yellow2"",""green2"",""blue2""),"
"0","  `red_yellow_blue` = SU_cols(""blue2"",""green2"",""yellow2"",""orange2"",""red2"")"
"0",")"
"0",""
"0","SU_pal <- function(palette = ""main"", reverse = FALSE, ...) {"
"0","  pal <- SU_palettes[[palette]]"
"0","  "
"0","  if (reverse) pal <- rev(pal)"
"0","  "
"0","  colorRampPalette(pal, ...)"
"0","}   "
"0",""
"0","scale_color_SU <- function(palette = ""main"", discrete = TRUE, reverse = FALSE, ...) {"
"0","  pal <- SU_pal(palette = palette, reverse = reverse)"
"0","  "
"0","  if (discrete) {"
"0","    discrete_scale(""colour"", paste0(""SU_"", palette), palette = pal, ...)"
"0","  } else {"
"0","    scale_color_gradientn(colours = pal(256), ...)"
"0","  }"
"0","}"
"0",""
"0",""
"0","scale_fill_SU <- function(palette = ""main"", discrete = TRUE, reverse = FALSE, ...) {"
"0","  pal <- SU_pal(palette = palette, reverse = reverse)"
"0","  "
"0","  if (discrete) {"
"0","    discrete_scale(""fill"", paste0(""SU_"", palette), palette = pal, ...)"
"0","  } else {"
"0","    scale_fill_gradientn(colours = pal(256), ...)"
"0","  }"
"0","}  "
"0",""
"0","##Theme"
"0",""
"0",""
"0","##set theme settings"
"0","theme_SU<-"
"0","  function (base_size){"
"0","    theme_minimal("
"0","      #base_family = ""Segoe UI"", "
"0","      base_size=12"
"0","      ) %+replace% "
"0","      theme(axis.title = element_text(size=11, face=""bold"",colour=SU_cols(""charcoal"")),"
"0","            plot.title = element_text(hjust=0,face=""bold"",size=12,colour=SU_cols(""charcoal""),margin=margin(b=4,unit=""pt"")),"
"0","            plot.subtitle = element_text(hjust=0,face=""italic"",size=10,colour=SU_cols(""charcoal""),margin=margin(b=4,unit=""pt"")),"
"0","            plot.caption = element_text(hjust = 0,face=""italic"",size=9,colour=SU_cols(""slate""),margin=margin(b=4,unit=""pt"")),"
"0","            legend.text = element_text(size=10,colour=SU_cols(""charcoal"")),"
"0","            legend.title = element_text(face=""bold"",size=11,colour=SU_cols(""charcoal""),margin=margin(b=4,unit=""pt"")))"
"0","  }"
"0",""
"0",""
"0",""
"0","##set theme by "
"0","theme_set(theme_SU())"
"0",""
"0",""
"0",""
"0","## A. Import SUS data ####"
"0",""
"0","# Connection"
"0","a.con <- dbConnect(odbc(), "
"0","                 Driver = ""SQL Server"", "
"0","                 server = ""PRODNHSESQL101"", "
"0","                 Database = ""NHSE_SUSPlus_Live"")"
